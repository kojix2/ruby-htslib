<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-ruby-htslib">ruby-htslib</h1>

<p><a href="https://badge.fury.io/rb/htslib"><img src="https://badge.fury.io/rb/htslib.svg"></a> <img src="https://github.com/kojix2/ruby-htslib/workflows/CI/badge.svg"> <a href="LICENSE.txt"><img src="https://img.shields.io/badge/license-MIT-blue.svg"></a> <a href="https://zenodo.org/badge/latestdoi/247078205"><img src="https://zenodo.org/badge/247078205.svg"></a> <a href="https://rubydoc.info/gems/htslib"><img src="https://img.shields.io/badge/docs-stable-blue.svg"></a></p>

<p>Ruby-htslib is the <a href="https://www.ruby-lang.org">Ruby</a> bindings to <a href="https://github.com/samtools/htslib">HTSlib</a>, a C library for high-throughput sequencing data formats. It allows you to read and write file formats commonly used in genomics, such as <a href="http://samtools.github.io/hts-specs/">SAM, BAM, VCF, and BCF</a> in the Ruby language.</p>

<p>:apple: Feel free to fork it out if you can develop it!</p>

<p>:bowtie: alpha stage.</p>

<h2 id="label-Requirements">Requirements</h2>
<ul><li>
<p><a href="https://github.com/ruby/ruby">Ruby</a> 2.7 or above.</p>
</li><li>
<p><a href="https://github.com/samtools/htslib">HTSlib</a></p>
</li><li>
<p>Ubuntu : <code>apt install libhts-dev</code></p>
</li><li>
<p>macOS : <code>brew install htslib</code></p>
</li><li>
<p>Build from source code (see Development section)</p>
</li></ul>

<h2 id="label-Installation">Installation</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_htslib'>htslib</span>
</code></pre>

<p>If you have installed htslib with apt on Ubuntu or homebrew on Mac, <a href="https://github.com/ruby-gnome/pkg-config">pkg-config</a> will automatically detect the location of the shared library. Alternatively, you can specify the directory of the shared library by setting the environment variable <code>HTSLIBDIR</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_export'>export</span> <span class='const'>HTSLIBDIR</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/your/path/to/htslib</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># libhts.so
</span></code></pre>

<h2 id="label-Overview">Overview</h2>

<h3 id="label-High+level+API">High level API</h3>

<p>Read SAM / BAM / CRAM - Sequence Alignment Map file</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>htslib</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_bam'>bam</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/Bam.html" title="HTS::Bam (class)">Bam</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="HTS/Bam.html#open-class_method" title="HTS::Bam.open (method)">open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a.bam</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_bam'>bam</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='label'>name:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_qname'>qname</span><span class='comma'>,</span>
    <span class='label'>flag:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_flag'>flag</span><span class='comma'>,</span>
    <span class='label'>chr:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_chrom'>chrom</span><span class='comma'>,</span>
    <span class='label'>pos:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='label'>mqual:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mapping_quality'>mapping_quality</span><span class='comma'>,</span>
    <span class='label'>cigar:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_cigar'>cigar</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
    <span class='label'>mchr:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mate_chrom'>mate_chrom</span><span class='comma'>,</span>
    <span class='label'>mpos:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mate_start'>mate_start</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='label'>isize:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_insert_size'>insert_size</span><span class='comma'>,</span>
    <span class='label'>seq:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_sequence'>sequence</span><span class='comma'>,</span>
    <span class='label'>qual:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_base_qualities'>base_qualities</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>33</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='comma'>,</span>
    <span class='label'>tagMC:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_tag'>tag</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_bam'>bam</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>Read VCF / BCF - Variant Call Format file</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bcf'>bcf</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/Bcf.html" title="HTS::Bcf (class)">Bcf</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="HTS/Bcf.html#open-class_method" title="HTS::Bcf.open (method)">open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b.bcf</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_bcf'>bcf</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='label'>chrom:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_chrom'>chrom</span><span class='comma'>,</span>
    <span class='label'>pos:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span><span class='comma'>,</span>
    <span class='label'>id:</span>     <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
    <span class='label'>qual:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_qual'>qual</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>ref:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='comma'>,</span>
    <span class='label'>alt:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_alt'>alt</span><span class='comma'>,</span>
    <span class='label'>filter:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_filter'>filter</span>
  <span class='comment'># info:   r.info
</span>  <span class='comment'># format: r.format
</span><span class='kw'>end</span>

<span class='id identifier rubyid_bcf'>bcf</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<h3 id="label-Low+level+API">Low level API</h3>

<p><code>HTS::LibHTS</code> provides native C functions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>htslib</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/LibHTS.html" title="HTS::LibHTS (module)">LibHTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hts_open'>hts_open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a.bam</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>r</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/LibHTS.html" title="HTS::LibHTS (module)">LibHTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hts_get_format'>hts_get_format</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span>
</code></pre>

<p>Note: htslib makes extensive use of macro functions for speed. you cannot use C macro functions in Ruby if they are not reimplemented in ruby-htslib. Only small number of C structs are implemented with FFI’s ManagedStruct, which frees memory when Ruby’s garbage collection fires. Other structs will need to be freed manually.</p>

<h3 id="label-Need+more+speed-3F">Need more speed?</h3>

<p>Try Crystal. <a href="https://github.com/bio-crystal/htslib.cr">htslib.cr</a> is implemented in Crystal language and provides an API compatible with ruby-htslib. Crsytal language is not as flexible as Ruby language. You can not use eval methods, and you must always be aware of the types. It is not very suitable for writing one-time scripts or experimenting with different code. However, If you have already written code in ruby-htslib, have a clear idea of the manipulations you want to do, and need to execute them many times, then by all means try to implement the command line tool using htslib.cr. The Crystal language is very fast and can perform almost as well as the Rust and C languages.</p>

<h2 id="label-Documentation">Documentation</h2>
<ul><li>
<p><a href="https://kojix2.github.io/ruby-htslib/">API Documentation (develop branch)</a></p>
</li><li>
<p><a href="https://rdoc.info/gems/htslib">RubyDoc.info - HTSlib</a></p>
</li></ul>

<h2 id="label-Development">Development</h2>

<p>To get started with development:</p>

<pre class="code ruby"><code class="ruby">git clone --recursive https://github.com/kojix2/ruby-htslib
cd ruby-htslib
bundle install
bundle exec rake htslib:build
bundle exec rake test
</code></pre>

<p><a href="https://en.wikipedia.org/wiki/GNU_Autotools">GNU Autotools</a> is required to compile htslib.</p>

<p>Many macro functions are used in HTSlib. Since these macro functions cannot be called using FFI, they must be reimplemented in Ruby.</p>
<ul><li>
<p>Actively use the advanced features of Ruby.</p>
</li><li>
<p>Remain compatibile with <a href="https://github.com/bio-crystal/htslib.cr">htslib.cr</a>.</p>
</li><li>
<p>The most difficult part is the return value. In the Crystal language, it is convenient for a method to return only one type. In the Ruby language, on the other hand, it is more convenient to return multiple classes. For example, in the Crystal language, it is confusing that a return value can take four types: Int32, Float32, Nil, and String. In Ruby, on the other hand, it is very common and does not cause any problems.</p>
</li></ul>

<h4 id="label-FFI+Extensions">FFI Extensions</h4>
<ul><li>
<p><a href="https://github.com/kojix2/ffi-bitfield">ffi-bitfield</a> : Extension of Ruby-FFI to support bitfields.</p>
</li></ul>

<h4 id="label-Automatic+generation+or+automatic+validation+-28Future+plan-29">Automatic generation or automatic validation (Future plan)</h4>
<ul><li>
<p><a href="https://github.com/rpav/c2ffi">c2ffi</a> is a tool to create JSON format metadata from C header files. It is planned to use c2ffi to automatically generate bindings or tests.</p>
</li></ul>

<h2 id="label-Contributing">Contributing</h2>

<p>Ruby-htslib is a library under development, so even small improvements like typofix are welcome! Please feel free to send us your pull requests.</p>
<ul><li>
<p><a href="https://github.com/kojix2/ruby-htslib/issues">Report bugs</a></p>
</li><li>
<p>Fix bugs and <a href="https://github.com/kojix2/ruby-htslib/pulls">submit pull requests</a></p>
</li><li>
<p>Write, clarify, or fix documentation</p>
</li><li>
<p>Suggest or add new features</p>
</li><li>
<p><a href="https://github.com/sponsors/kojix2">financial contributions</a></p>
</li></ul>

<pre class="code ruby"><code class="ruby">Do you need commit rights to ruby-htslib repository?
Do you want to get admin rights and take over the project?
If so, please feel free to contact us @kojix2.
</code></pre>

<h4 id="label-Why+do+you+implement+htslib+in+a+language+like+Ruby-2C+which+is+not+widely+used+in+the+bioinformatics-3F">Why do you implement htslib in a language like Ruby, which is not widely used in the bioinformatics?</h4>

<p>One of the greatest joys of using a minor language like Ruby in bioinformatics is that there is nothing stopping you from reinventing the wheel. Reinventing the wheel can be fun. But with languages like Python and R, where many bioinformatics masters work, there is no chance left for beginners to create htslib bindings. Bioinformatics file formats, libraries and tools are very complex and I don’t know how to understand them. So I wanted to implement the HTSLib binding myself to better understand how the pioneers of bioinformatics felt when establishing the file format and how they created their tools. And that effort is still going on today…</p>

<h2 id="label-Links">Links</h2>
<ul><li>
<p><a href="https://github.com/samtools/hts-specs">samtools/hts-spec</a></p>
</li><li>
<p><a href="https://github.com/bioruby/bioruby">bioruby</a></p>
</li></ul>

<h2 id="label-Funding+support">Funding support</h2>

<p>This work was supported partially by <a href="https://www.ruby.or.jp/en/news/20201022">Ruby Association Grant 2020</a>.</p>

<h2 id="label-License">License</h2>

<p><a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

      <div id="footer">
  Generated on Mon Apr  4 16:04:34 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.1.1).
</div>

    </div>
  </body>
</html>