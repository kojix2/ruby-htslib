<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-ruby-htslib">ruby-htslib</h1>

<p><a href="https://badge.fury.io/rb/htslib"><img src="https://badge.fury.io/rb/htslib.svg"></a> <img src="https://github.com/kojix2/ruby-htslib/workflows/CI/badge.svg"> <a href="LICENSE.txt"><img src="https://img.shields.io/badge/license-MIT-blue.svg"></a> <a href="https://zenodo.org/badge/latestdoi/247078205"><img src="https://zenodo.org/badge/247078205.svg"></a> <a href="https://rubydoc.info/gems/htslib"><img src="https://img.shields.io/badge/docs-stable-blue.svg"></a></p>

<p>Ruby-htslib is the <a href="https://www.ruby-lang.org">Ruby</a> bindings to <a href="https://github.com/samtools/htslib">HTSlib</a>, a C library for high-throughput sequencing data formats. It allows you to read and write file formats commonly used in genomics, such as <a href="http://samtools.github.io/hts-specs/">SAM, BAM, VCF, and BCF</a>, in the Ruby language.</p>

<p>:apple: Feel free to fork it!</p>

<h2 id="label-Requirements">Requirements</h2>
<ul><li>
<p><a href="https://github.com/ruby/ruby">Ruby</a> 3.1 or above.</p>
</li><li>
<p><a href="https://github.com/samtools/htslib">HTSlib</a></p>
</li><li>
<p>Ubuntu : <code>apt install libhts-dev</code></p>
</li><li>
<p>macOS : <code>brew install htslib</code></p>
</li><li>
<p>Windows : <a href="https://packages.msys2.org/base/mingw-w64-htslib">mingw-w64-htslib</a> is automatically fetched when installing the gem (<a href="https://rubyinstaller.org">RubyInstaller</a> only).</p>
</li><li>
<p>Build from source code (see Development section)</p>
</li></ul>

<h2 id="label-Installation">Installation</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_htslib'>htslib</span>
</code></pre>

<p>If you have installed htslib with apt on Ubuntu or homebrew on Mac, <a href="https://github.com/ruby-gnome/pkg-config">pkg-config</a> will automatically detect the location of the shared library. If pkg-config does not work well, set <code>PKG_CONFIG_PATH</code>. Alternatively, you can specify the directory of the shared library by setting the environment variable <code>HTSLIBDIR</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_export'>export</span> <span class='const'>HTSLIBDIR</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/your/path/to/htslib</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># libhts.so
</span></code></pre>

<p>ruby-htslib also works on Windows; if you use RubyInstaller, htslib will be prepared automatically.</p>

<h2 id="label-Overview">Overview</h2>

<h3 id="label-High-level+API">High-level API</h3>

<h4 id="label-HTS-3A-3ABam+-+SAM+-2F+BAM+-2F+CRAM+-+Sequence+Alignment+Map+file">HTS::Bam - SAM / BAM / CRAM - Sequence Alignment Map file</h4>

<p>Reading fields</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>htslib</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_bam'>bam</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/Bam.html" title="HTS::Bam (class)">Bam</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="HTS/Bam.html#open-class_method" title="HTS::Bam.open (method)">open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test/fixtures/moo.bam</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_bam'>bam</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
  <span class='id identifier rubyid_pp'>pp</span> <span class='label'>name:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_qname'>qname</span><span class='comma'>,</span>
     <span class='label'>flag:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_flag'>flag</span><span class='comma'>,</span>
     <span class='label'>chrm:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_chrom'>chrom</span><span class='comma'>,</span>
     <span class='label'>strt:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
     <span class='label'>mapq:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mapq'>mapq</span><span class='comma'>,</span>
     <span class='label'>cigr:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_cigar'>cigar</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
     <span class='label'>mchr:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mate_chrom'>mate_chrom</span><span class='comma'>,</span>
     <span class='label'>mpos:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_mpos'>mpos</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
     <span class='label'>isiz:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_isize'>isize</span><span class='comma'>,</span>
     <span class='label'>seqs:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_seq'>seq</span><span class='comma'>,</span>
     <span class='label'>qual:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_qual_string'>qual_string</span><span class='comma'>,</span>
     <span class='label'>MC:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_aux'>aux</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_bam'>bam</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<h4 id="label-HTS-3A-3ABcf+-+VCF+-2F+BCF+-+Variant+Call+Format+file">HTS::Bcf - VCF / BCF - Variant Call Format file</h4>

<p>Reading fields</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bcf'>bcf</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/Bcf.html" title="HTS::Bcf (class)">Bcf</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="HTS/Bcf.html#open-class_method" title="HTS::Bcf.open (method)">open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b.bcf</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_bcf'>bcf</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='label'>chrom:</span>  <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_chrom'>chrom</span><span class='comma'>,</span>
    <span class='label'>pos:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_pos'>pos</span><span class='comma'>,</span>
    <span class='label'>id:</span>     <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
    <span class='label'>qual:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_qual'>qual</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>ref:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='comma'>,</span>
    <span class='label'>alt:</span>    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_alt'>alt</span><span class='comma'>,</span>
    <span class='label'>filter:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span>
    <span class='label'>info:</span>   <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='comma'>,</span>
    <span class='label'>format:</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_bcf'>bcf</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>&lt;details&gt; &lt;summary&gt;<strong>Faidx</strong>&lt;/summary&gt;</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_fa'>fa</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/Faidx.html" title="HTS::Faidx (class)">Faidx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open'><span class='object_link'><a href="HTS/Faidx.html#open-class_method" title="HTS::Faidx.open (method)">open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c.fa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_fa'>fa</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chr1:1-10</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_fa'>fa</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>&lt;/details&gt;</p>

<p>&lt;details&gt; &lt;summary&gt;<strong>Tbx</strong>&lt;/summary&gt;</p>

<pre class="code ruby"><code class="ruby">
</code></pre>

<p>&lt;/details&gt;</p>

<h3 id="label-Low-level+API">Low-level API</h3>

<p><code>HTS::LibHTS</code> provides native C functions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>htslib</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/LibHTS.html" title="HTS::LibHTS (module)">LibHTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hts_open'><span class='object_link'><a href="HTS/LibHTS.html#hts_open-class_method" title="HTS::LibHTS.hts_open (method)">hts_open</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a.bam</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>r</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HTS.html" title="HTS (module)">HTS</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HTS/LibHTS.html" title="HTS::LibHTS (module)">LibHTS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_hts_get_format'><span class='object_link'><a href="HTS/LibHTS.html#hts_get_format-class_method" title="HTS::LibHTS.hts_get_format (method)">hts_get_format</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span>
</code></pre>

<p>Macro functions</p>

<p>htslib has a lot of macro functions for speed. Ruby-FFI cannot call C macro functions. However, essential functions are reimplemented in Ruby, and you can call them.</p>

<p>Structs</p>

<p>Only a small number of C structs are implemented with FFI’s ManagedStruct, which frees memory when Ruby’s garbage collection fires. Other structs will need to be freed manually.</p>

<h3 id="label-Need+more+speed-3F">Need more speed?</h3>

<p>Try Crystal. <a href="https://github.com/bio-cr/hts.cr">HTS.cr</a> is implemented in Crystal language and provides an API compatible with ruby-htslib. Crystal language is not as flexible as Ruby language. You can not use <code>eval</code> methods and must always be careful with the types. Writing one-time scripts in Crystal may be less fun. However, if you have a clear idea of what you want to do in your mind, have already written code in Ruby, and need to run them over and over, try creating a command line tool in Crystal. The Crystal language is as fast as the Rust and C languages. It will give you incredible power to make tools.</p>

<h2 id="label-Documentation">Documentation</h2>
<ul><li>
<p><a href="TUTORIAL_md.html">TUTORIAL.md</a></p>
</li><li>
<p><a href="https://kojix2.github.io/ruby-htslib/">API Documentation (develop branch)</a></p>
</li><li>
<p><a href="https://rdoc.info/gems/htslib">RubyDoc.info - HTSlib</a></p>
</li></ul>

<h2 id="label-Development">Development</h2>

<p>To get started with development:</p>

<pre class="code ruby"><code class="ruby">git clone --recursive https://github.com/kojix2/ruby-htslib
cd ruby-htslib
bundle install
bundle exec rake htslib:build
bundle exec rake test
</code></pre>

<p><a href="https://en.wikipedia.org/wiki/GNU_Autotools">GNU Autotools</a> is required to compile htslib.</p>

<p>HTSlib has many macro functions. These macro functions cannot be called from FFI and must be reimplemented in Ruby.</p>
<ul><li>
<p>Use the new version of Ruby to take full advantage of Ruby’s potential.</p>
</li><li>
<p>This is possible because we have a small number of users.</p>
</li><li>
<p>Remain compatible with <a href="https://github.com/bio-cr/hts.cr">HTS.cr</a>.</p>
</li><li>
<p>The most challenging part is the return value. In the Crystal language, methods are expected to return only one type. On the other hand, in the Ruby language, methods that return multiple classes are very common. For example, in the Crystal language, the compiler gets confused if the return value is one of six types: Int32, Int64, Float32, Float64, Nil, or String. In fact Crystal allows you to do that. But the code gets a little messy. In Ruby, this is very common and doesn’t cause any problems.</p>
</li><li>
<p>Ruby and Crystal are languages that use garbage collection. However, the memory release policy for allocated C structures is slightly different: in Ruby-FFI, you can define a <code>self.release</code> method in <code>FFI::Struct</code>. This method is called when GC. So you don’t have to worry about memory in high-level APIs like Bam::Record or Bcf::Record, etc. Crystal requires you to define a finalize method on each class. So you need to define it in Bam::Record or Bcf::Record.</p>
</li></ul>

<p>Method naming generally follows the Rust-htslib API.</p>

<h4 id="label-FFI+Extensions">FFI Extensions</h4>
<ul><li>
<p><a href="https://github.com/kojix2/ffi-bitfield">ffi-bitfield</a> : Extension of Ruby-FFI to support bitfields.</p>
</li></ul>

<h4 id="label-Automatic+validation">Automatic validation</h4>

<p>In the <code>script</code> directory, there are several tools to help implement ruby-htslib. Scripts using c2ffi can check the coverage of htslib functions in Ruby-htslib. They are useful when new versions of htslib are released.</p>
<ul><li>
<p><a href="https://github.com/rpav/c2ffi">c2ffi</a> is a tool to create JSON format metadata from C header files.</p>
</li></ul>

<h2 id="label-Contributing">Contributing</h2>

<p>Ruby-htslib is a library under development, so even minor improvements like typo fixes are welcome! Please feel free to send us your pull requests.</p>
<ul><li>
<p><a href="https://github.com/kojix2/ruby-htslib/issues">Report bugs</a></p>
</li><li>
<p>Fix bugs and <a href="https://github.com/kojix2/ruby-htslib/pulls">submit pull requests</a></p>
</li><li>
<p>Write, clarify, or fix documentation</p>
</li><li>
<p>Suggest or add new features</p>
</li><li>
<p><a href="https://github.com/sponsors/kojix2">financial contributions</a></p>
</li></ul>

<pre class="code ruby"><code class="ruby"># Ownership and Commitment Rights

Do you need commit rights to the ruby-htslib repository?
Do you want to get admin rights and take over the project?
If so, please feel free to contact us @kojix2.
</code></pre>

<h4 id="label-Why+do+you+implement+htslib+in+a+language+like+Ruby-2C+which+is+not+widely+used+in+bioinformatics-3F">Why do you implement htslib in a language like Ruby, which is not widely used in bioinformatics?</h4>

<p>One of the greatest joys of using a minor language like Ruby in bioinformatics is that nothing stops you from reinventing the wheel. Reinventing the wheel can be fun. But with languages like Python and R, where many bioinformatics masters work, there is no chance for beginners to create htslib bindings. Bioinformatics file formats, libraries, and tools are very complex, and I need to learn how to understand them. So I started to implement the HTSLib binding myself to better understand how the pioneers of bioinformatics felt when establishing the file format and how they created their tools. I hope one day we can work on bioinformatics using Ruby and Crystal languages, not to replace other languages such as Python and R, but to add new power and value to this advancing field.</p>

<h2 id="label-Links">Links</h2>
<ul><li>
<p><a href="https://github.com/samtools/hts-specs">samtools/hts-spec</a></p>
</li><li>
<p><a href="https://github.com/bioruby/bioruby">bioruby</a></p>
</li></ul>

<h2 id="label-Funding+support">Funding support</h2>

<p>This work was supported partially by <a href="https://www.ruby.or.jp/en/news/20201022">Ruby Association Grant 2020</a>.</p>

<h2 id="label-License">License</h2>

<p><a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

      <div id="footer">
  Generated on Thu Oct 27 09:50:45 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>